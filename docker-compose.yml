services:
  k2so-watcher:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: k2so-watcher
    network_mode: host

    volumes:
      - k2so-data:/app/data
      - k2so-backups:/app/backups
    environment:
      - SERVER_PORT=8080
      - ADMIN_USERNAME=admin
      - ADMIN_PASSWORD=admin
      - NETWORK_SCAN_RANGE=10.40.30.0/24
      - SCANNER_TOOL=nmap
      - SCHEDULER_ENABLED=true
      - SCHEDULER_CRON=0 0 2 * * *
      - AI_ENABLED=false
      - JAVA_OPTS=-Xmx512m -Xms256m -Duser.timezone=America/New_York
      - TZ=America/New_York
    cap_add:
      - NET_RAW
      - NET_ADMIN
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/login"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s

volumes:
  k2so-data:
    driver: local
  k2so-backups:
    driver: local
