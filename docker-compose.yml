services:
  k2so-watcher:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: k2so-watcher
    # Network mode host is required for network scanning to work properly
    network_mode: host
    # Alternatively, if you don't want host mode, you can use:
    # ports:
    #   - "8080:8080"
    volumes:
      # Persist H2 database
      - k2so-data:/app/data
    environment:
      # Timezone Configuration
      - TZ=America/New_York

      # Server Configuration
      - SERVER_PORT=8080

      # Database Configuration
      - DB_PATH=/app/data/k2so_watcher
      - DB_USERNAME=k2so
      - DB_PASSWORD=k2so_secure_password

      # Network Scanner Configuration
      - NETWORK_SCAN_RANGE=10.40.30.0/24
      - SCANNER_TOOL=nmap
      - SCAN_TIMEOUT=120

      # Scheduler Configuration
      - SCHEDULER_ENABLED=true
      - SCHEDULER_CRON=0 0 2 * * *

      # Admin Configuration
      - ADMIN_USERNAME=admin
      - ADMIN_PASSWORD=admin

      # AI Configuration (optional)
      - AI_ENABLED=false
      - AI_PROVIDER=openai
      - AI_API_KEY=
      - AI_MODEL=gpt-4

      # Java Options
      - JAVA_OPTS=-Xmx512m -Xms256m -Duser.timezone=America/New_York
    # Required capabilities for network scanning
    cap_add:
      - NET_RAW
      - NET_ADMIN
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/login"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s

volumes:
  k2so-data:
    driver: local
